# 樹種コード修正

## 問題

樹種が数字だけで表示され、日本語名（例：トドマツ）が表示されていませんでした。

## 原因

調査簿データの樹種コードとコードマスタの樹種コードの形式が異なっていました：

- **調査簿データ**: `'4'` （0埋めなし）
- **コードマスタ**: `'04'` （0埋めあり）

このため、コードマスタの辞書検索で一致せず、日本語名が取得できませんでした。

## 修正内容

`load_code_master()` 関数を修正して、樹種コードを0埋めあり/なし両方の形式で辞書に登録するようにしました。

### 修正前

```python
# 樹種コードを0埋めありの形式のみで登録
code_masters['樹種'][code_str] = name_str  # '04' -> 'クロマツ'
```

### 修正後

```python
# 0埋めあり（01, 02）と0埋めなし（1, 2）の両方で登録
code_masters['樹種'][code_str] = name_str  # '04' -> 'クロマツ'
# 0埋めなしバージョンも登録
code_no_zero = str(int(code_str))
code_masters['樹種'][code_no_zero] = name_str  # '4' -> 'クロマツ'
```

## 確認結果

データ変換後、層索引JSONを確認：

```
樹種1コード: 4
樹種1名: クロマツ
林種コード: 1
林種名: 人工林
```

✅ 樹種1名が正しく設定されています。

## 動作確認

### 1. データ再変換完了

```
コードマスタを読み込み中...
  森林の種類コードを読み込み中...
  林種コードを読み込み中...
  樹種コードを読み込み中...
  ✓ 森林の種類: 23 件
  ✓ 林種: 6 件
  ✓ 樹種: 39 件（0埋めあり/なし両対応）
```

### 2. ブラウザで確認

1. ブラウザをリロード（Ctrl+F5）
2. 森林簿ボタンをON
3. 小班をクリック
4. ポップアップに樹種名が表示されることを確認

**期待される表示**:
```
層1 (複層区分: 1)
森林種類: 15 (防風保安林)
林種: 1 (人工林)
樹種: 4 (クロマツ)  ← これが表示される
林齢: 71年
面積: 1.91 ha
```

## 樹種コード一覧（抜粋）

| コード（0埋めあり） | コード（0埋めなし） | 樹種名 |
|---------------------|---------------------|--------|
| 01 | 1 | イチイ |
| 02 | 2 | スギ |
| 03 | 3 | アカマツ |
| 04 | 4 | クロマツ |
| 17 | 17 | カラマツ |
| 18 | 18 | グイマツ |
| 22 | 22 | トドマツ |
| 23 | 23 | エゾマツ |
| 24 | 24 | アカエゾマツ |
| ... | ... | ... |

## 技術的な詳細

### コードマスタの読み込み位置

樹種コードは「コード一覧」シートの**行53から**始まります（行52ではない）。

```python
# (5) 樹種（行53-84付近）
for i in range(53, 84):  # 行53-83
    code = df.iloc[i, 0]  # A列
    name = df.iloc[i, 5]  # F列
```

### 0埋め正規化

調査簿データの樹種コードは文字列型で読み込まれるため、そのまま辞書検索できます。

```python
# 調査簿データ
'樹種1コード': '4'  # 文字列

# コードマスタ辞書
code_masters['樹種']['4'] = 'クロマツ'  # 0埋めなし
code_masters['樹種']['04'] = 'クロマツ'  # 0埋めあり
```

## 関連ファイル

- `backend/convert_forest_registry_to_geojson.py` - 修正したスクリプト
- `backend/data/administrative/rinsyousigen/森林調査簿コード.xlsx` - コードマスタ
- `backend/data/administrative/rinsyousigen/layers_index.json` - 更新された層索引
